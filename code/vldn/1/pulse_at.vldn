channel = get_current_channel()

if (channel == "calculate_activation_ts") {
    next = now() + get_config("interval")
    set_state("next_activation_ts", next)
    return
}

if (channel == "activate") {
    last_output = get_state("last_output")
    new_output = !last_output
    set_state("last_output", new_output)
    set_output("pulse", new_output)
    return
}
